## Setup
conda activate py27env
cd /mnt/Data0/PROJECTS/CROPSeq/FullScale/Results/1_GuideAssignment/
BAMDIR=/mnt/Data0/PROJECTS/CROPSeq/FullScale/Data/GOK9962_hnPCR_1/BAM/
BAMFILE=/outs/possorted_genome_bam.bam
SAMPLELIST=/mnt/Data0/PROJECTS/CROPSeq/FullScale/Data/GOK9962_hnPCR_1/BAM/Samples
OUT=_hnPCR.txt
getProtospacers=/mnt/Data0/PROJECTS/CROPSeq/FullScale/Scripts/getProtospacers.py


## Apply the python script getProtospacers to the output of heminested PCR
while read -r sample; do \
python $getProtospacers --input_bams $BAMDIR/$sample/$BAMFILE -o $sample$OUT --search_seq GTGGAAAGGACGAAACACC --no_swalign --barcode_length 16; \
done < $SAMPLELIST


## Repeat with hnPCR2
OUT=_hnPCR2.txt
BAMDIR=/mnt/Data0/PROJECTS/CROPSeq/FullScale/Data/GOK10211_hnPCR_2/BAM/

while read -r sample; do \
python $getProtospacers --input_bams $BAMDIR/$sample/$BAMFILE -o $sample$OUT --search_seq GTGGAAAGGACGAAACACC --no_swalign --barcode_length 16; \
done < $SAMPLELIST

